var H=Object.defineProperty;var Y=(e,t,s)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var a=(e,t,s)=>(Y(e,typeof t!="symbol"?t+"":t,s),s);import{C as x,S as R,L as y,T as G,a as W,P as X,b as Q,B as V,c as Z,d as K}from"./vendor.0a85182d.js";const tt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};tt();var A=(e=>(e.ArrowLeft="arrowleft",e.ArrowRight="arrowRight",e.ArrowUp="arrowup",e.ArrowDown="arrowdown",e.Enter="Enter",e.Space=" ",e))(A||{});const w=class{constructor(t=window){a(this,"pressedKeys",new Map);a(this,"newPressedKeys",[]);a(this,"newReleasedKeys",[]);a(this,"_mousePosition",{x:0,y:0});a(this,"wasMouseClicked",!1);t.addEventListener("keydown",s=>{this._handleKeyboardEvent(s,"KEY_DOWN")}),t.addEventListener("keyup",s=>{this._handleKeyboardEvent(s,"KEY_UP")}),t.addEventListener("mousemove",s=>{s.target.nodeName==="CANVAS"&&this._handleMouseEvent(s,"MOUSE_MOVE")}),t.addEventListener("click",s=>{s.target.nodeName==="CANVAS"&&this._handleMouseEvent(s,"MOUSE_CLICK")})}static get shared(){return w._instance||(w._instance=new w),w._instance}flush(){this.newPressedKeys=[],this.newReleasedKeys=[],this.wasMouseClicked=!1}_handleKeyboardEvent(t,s){s==="KEY_DOWN"?(this.keyUp(t.key.toUpperCase())&&this.newPressedKeys.indexOf(t.key.toUpperCase())<0&&this.newPressedKeys.push(t.key.toUpperCase()),this.pressedKeys.set(t.key.toUpperCase(),!0)):(this.keyDown(t.key.toUpperCase())&&this.newReleasedKeys.indexOf(t.key.toUpperCase())<0&&this.newReleasedKeys.push(t.key.toUpperCase()),this.pressedKeys.set(t.key.toUpperCase(),!1))}_handleMouseEvent(t,s){const i=t.target;this._mousePosition={x:Math.round(t.clientX-i.getBoundingClientRect().left),y:Math.round(t.clientY-i.getBoundingClientRect().top)},s==="MOUSE_CLICK"&&(this.wasMouseClicked=!0)}keyPressed(t){return this.newPressedKeys.indexOf(t.toUpperCase())>=0}keyReleased(t){return this.newReleasedKeys.indexOf(t.toUpperCase())>=0}keyDown(t){return this.pressedKeys.has(t.toUpperCase())&&this.pressedKeys.get(t.toUpperCase())===!0}keyUp(t){return!this.keyDown(t.toUpperCase())}getNewKeys(){return this.newPressedKeys}get mousePosition(){return this._mousePosition}get mouseClicked(){return this.wasMouseClicked}};let f=w;a(f,"_instance");class c{constructor(t=0,s=0){this.x=t,this.y=s}static fromRotation(t){return new c(Math.cos(t),Math.sin(t))}static copyFrom(t){return new c(t.x,t.y)}multiply(t){return new c(this.x*t,this.y*t)}subtract(t){return new c(this.x-t.x,this.y-t.y)}angle(){return Math.atan2(this.y,this.x)}angleBetween(t){return Math.atan2(t.y-this.y,t.x-this.x)}distanceFrom(t){return B(this,t)}moveTowards(t,s){const i=this.angleBetween(t),r=this.distanceFrom(t);return new c(this.x+Math.cos(i)*(s<r?s:r),this.y+Math.sin(i)*(s<r?s:r))}}function B(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function v(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}function et(e,t){return Math.random()*(t-e)+e}function st(e){if(e.length===0)throw new Error("Cannot choose from empty list.");return e[v(0,e.length)]}function O(e,t){return e<0&&(e=0),e>t.length-1&&(e=t.length-1),t[e]}function D(e,t,s){return t*(O(e+1,s)-O(e-1,s))/2}function _(e,t,s=1){const i=Math.floor(t),r=[D(i,s,e),D(i+1,s,e)],o=[O(i,e),O(i+1,e)];t-=i;const n=t*t,d=t*n;return(2*d-3*n+1)*o[0]+(d-2*n+t)*r[0]+(-2*d+3*n)*o[1]+(d-n)*r[1]}const m=class{constructor(){a(this,"_subscriptions",new Map)}static get shared(){return m._instance===null&&(m._instance=new m),m._instance}connect(t,s){const i=this._subscriptions.get(t)||[];i.push(s),this._subscriptions.set(t,i)}trigger(t,...s){const i=this._subscriptions.get(t)||[];for(const r of i)r(s)}removeAllListeners(){this._subscriptions.clear()}};let u=m;a(u,"_instance",null);let it=0;var T=(e=>(e[e.Awaiting=0]="Awaiting",e[e.HaveJumper=1]="HaveJumper",e[e.JumperJumped=2]="JumperJumped",e))(T||{});const rt=Math.PI*.65,ot=Math.PI*1.25;class k extends x{constructor(t=50){super();a(this,"orbitPivot",new x);a(this,"orbitPosition",new x);a(this,"orbitSpeed",et(rt,ot));a(this,"rotationSpeed",Math.PI*.02);a(this,"orbitStart",0);a(this,"currentOrbits",3);a(this,"jumperState",0);a(this,"orbitsText");a(this,"spr");a(this,"uid",++it);this.radius=t,this.orbitSpeed*=Math.pow(-1,v(0,2)%2),this.rotationSpeed*=Math.pow(-1,v(0,2)%2),this.spr=new R(y.shared.resources["meteor-large.png"].texture),this.spr.anchor.set(.5,.5);const s=1/128*(t*2);this.spr.scale.set(s,s),this.spr.tint=st([16776960,16711680,16755200,11206400]),this.addChild(this.spr),this.orbitPivot.position.set(0,0),this.orbitPivot.addChild(this.orbitPosition),this.orbitPosition.position.set(this.radius+25,0),this.addChild(this.orbitPivot);const i=new G({fontFamily:"Arial",fontSize:36,fontStyle:"italic",fontWeight:"bold",fill:["#ffffff","#00ff99"],stroke:"#4a1850",strokeThickness:3,dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:2,lineJoin:"round"});this.orbitsText=new W(`${this.currentOrbits}`,i),this.orbitsText.anchor.set(.5,.5),this.orbitsText.visible=!1,this.addChild(this.orbitsText)}static spawn(t,s){s=s||v(30,80);const i=new k(s);return i.position.set(t.x,t.y),i}update(t){this.spr.rotation+=this.rotationSpeed*t,this.orbitPivot.rotation+=this.orbitSpeed*t,this.orbitsText.visible=this.jumperState===1,this.jumperState===1&&Math.abs(this.orbitPivot.rotation-this.orbitStart)>Math.PI*2&&(this.currentOrbits-=1,this.orbitsText.text=`${this.currentOrbits}`,this.currentOrbits<=0&&u.shared.trigger("OutOfOrbits",this),this.orbitStart=this.orbitPivot.rotation)}checkJumperCollision(t){return B(this.position,t.position)<=this.radius+32?(this.orbitPivot.rotation=new c(this.position.x,this.position.y).angleBetween(new c(t.position.x,t.position.y)),this.orbitStart=this.orbitPivot.rotation,this.jumperState=1,t.onAreaEntered(this),!0):!1}implode(){u.shared.trigger("CircleImploded",this)}}class nt extends R{constructor(){super(y.shared.resources["jumper.png"].texture);a(this,"velocity",new c(100,0));a(this,"jumpSpeed",500);a(this,"attachedTo",null);this.anchor.set(.5,.5),this.pivot.set(.5,1)}jump(){this.attachedTo&&(this.attachedTo.jumperState=T.JumperJumped,this.attachedTo=null,this.velocity=c.fromRotation(this.rotation).multiply(this.jumpSpeed))}onAreaEntered(t){this.attachedTo=t,this.velocity=new c,u.shared.trigger("JumperCaptured",t)}update(t){if(this.attachedTo){let{x:s,y:i}=this.attachedTo.position;const r=c.fromRotation(this.attachedTo.orbitPivot.rotation);s+=r.x*(this.attachedTo.radius+25),i+=r.y*(this.attachedTo.radius+25),this.position.set(s,i),this.rotation=this.attachedTo.orbitPivot.rotation}else this.position.set(this.position.x+this.velocity.multiply(t).x,this.position.y+this.velocity.multiply(t).y)}}async function at(){return new Promise((e,t)=>{y.shared.add("jumper.png","/circle-jump-webgl/jumper.png"),y.shared.add("meteor-large.png","/circle-jump-webgl/meteor-large.png"),y.shared.add("trail.png","/circle-jump-webgl/trail.png"),y.shared.load((s,i)=>{e()})})}const g=class{constructor(){a(this,"timers",[]);a(this,"timerUid",0)}static get shared(){return g._instance===null&&(g._instance=new g),g._instance}stopAll(t=!1){if(t)for(const s of this.timers)s.callback();this.timers=[]}processTimers(t){for(const s of this.timers)s.remaining-=t,s.remaining<=0&&(s.callback(),this.timers.splice(this.timers.indexOf(s),1))}add(t,s){const i={remaining:t,callback:s,uid:++this.timerUid};return this.timers.push(i),i.uid}stop(t){const s=this.timers.findIndex(i=>i.uid===t);return s?(this.timers.splice(s,1),!0):!1}};let S=g;a(S,"_instance",null);function ht(e){window.localStorage&&window.localStorage.setItem("highscore",e.toString())}function J(){if(!window.localStorage)return 0;try{const e=window.localStorage.getItem("highscore");return e?parseInt(e):0}catch{return 0}}function U(){const e=document.getElementById("score");if(!e)throw new Error("#score div does not exist.");return e}function j(){const e=document.getElementById("start-overlay");if(!e)throw new Error("#start-overlay div does not exist.");return e}function ct(e=0){U().querySelector("span").textContent=`${e}`,U().classList.add("pulse"),S.shared.add(.5,()=>{U().classList.remove("pulse")})}function dt(e){e?(ut(),j().classList.remove("hide")):j().classList.add("hide")}function lt(){const e=document.getElementById("highscore");if(!e)throw new Error("#highscore div does not exist.");return e}function ut(){lt().querySelector("span").textContent=`Personal Best: ${J()}`}var P={setScore:ct,setShowStart:dt};class pt extends x{constructor(t,s=100,i=20){super();a(this,"points",[]);a(this,"history",[]);a(this,"rope");this.ropeSize=s,this.historySize=i;for(let o=0;o<i;++o)this.history.push([t.x,t.y]);for(let o=0;o<s;++o)this.points.push(new X(t.x,t.y));const r=y.shared.resources["trail.png"].texture;this.rope=new Q(r,this.points),this.rope.blendMode=V.ADD,this.rope.tint=16777079,this.addChild(this.rope)}addPoint(t){this.history.pop(),this.history.unshift([t.x,t.y]);const s=this.history.map(r=>r[0]),i=this.history.map(r=>r[1]);for(let r=0;r<this.ropeSize;++r){const o=this.points[r],n=_(s,r/this.ropeSize*this.historySize),d=_(i,r/this.ropeSize*this.historySize);o.x=n,o.y=d}}}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#app"),t=Z({antialias:!1,autoDensity:!0,backgroundAlpha:0,width:480,height:854}),s=new x,i=new x,r=new c(240,700);let o=new c,n,d=0,E,C=0;at().then(()=>{for(s.addChild(i);e.lastChild;)e.removeChild(e.lastChild);e.appendChild(t.view);function N(h){const[b]=h,{x:p,y:l}=b.position;o.x=-240+p,o.y=-700+l,I(),d+=1,P.setScore(d)}u.shared.connect("JumperCaptured",N);function $([h]){h===n.attachedTo&&L()}u.shared.connect("OutOfOrbits",$);function z([h]){i.removeChild(h)}u.shared.connect("CircleImploded",z);function L(){d>0&&d>J()&&ht(d),d=0,P.setScore(0),i.removeChildren(),S.shared.stopAll(),C=0,P.setShowStart(!0)}function q(){n=new nt,n.position.set(r.x,r.y),o.x=-240+r.x,o.y=-700+r.y,i.pivot.set(o.x,o.y),i.addChild(n),E=new pt(n.position),i.addChild(E),I(r,50),C=1,P.setShowStart(!1)}function I(h,b){var l,M;h=h||{x:(((l=n.attachedTo)==null?void 0:l.position.x)||0)+v(-150,150),y:(((M=n.attachedTo)==null?void 0:M.position.y)||0)+v(-550,-300)};const p=k.spawn(h,b);return i.addChild(p),p}function F(h){return!(h.x<i.pivot.x||h.x>t.width+i.pivot.x||h.y<i.pivot.y||h.y>t.height+i.pivot.y)}L(),e.classList.add("ready"),K.shared.add(()=>{const h=K.shared.elapsedMS*.001;if(S.shared.processTimers(h),C===0)(f.shared.keyPressed(A.Space)||f.shared.mouseClicked)&&q();else if(C===1&&n){n.update(h),E.addPoint(n.position);for(const l of i.children.filter(M=>M instanceof k))l.update(h),!n.attachedTo&&l.jumperState===T.Awaiting?l.checkJumperCollision(n):l.jumperState===T.JumperJumped&&l.visible&&(F(l.position)||l.implode());const b=1e3*h,p=new c(i.pivot.x,i.pivot.y).moveTowards(o,b);i.pivot.set(p.x,p.y),(f.shared.keyPressed(A.Space)||f.shared.mouseClicked)&&n.jump(),(n.position.x<i.pivot.x||n.position.x>t.width+i.pivot.x||n.position.y<i.pivot.y||n.position.y>t.height+i.pivot.y)&&L()}t.render(s),f.shared.flush()})})});
